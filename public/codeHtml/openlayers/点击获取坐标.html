<!doctype html>
<html lang="zh-CN">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>OpenLayers å¤©åœ°å›¾çŸ¢é‡åœ°å›¾ - ç‚¹å‡»è·å–åæ ‡</title>
    <!-- OpenLayers CSS - ä½¿ç”¨æœ¬åœ°åº“æ–‡ä»¶ -->
    <link rel="stylesheet" href="/libs/Openlayers/ol.min.css" type="text/css" />
    <style>
      body {
        margin: 0;
        padding: 0;
        font-family: 'Microsoft YaHei', Arial, sans-serif;
      }

      #map {
        width: 100%;
        height: 100vh;
        cursor: crosshair;
      }

      /* é¼ æ ‡æç¤ºæ ·å¼ */
      .mouse-tip {
        position: absolute;
        right: 20px;
        top: 20px;
        background: rgba(0, 0, 0, 0.8);
        color: white;
        padding: 10px 15px;
        border-radius: 5px;
        font-size: 14px;
        z-index: 1000;
        pointer-events: none;
        box-shadow: 0 2px 10px rgba(0, 0, 0, 0.3);
      }

      /* åº•éƒ¨åæ ‡å¡ç‰‡æ ·å¼ */
      .coordinate-card {
        position: fixed;
        bottom: 20px;
        left: 50%;
        transform: translateX(-50%);
        background: white;
        border-radius: 8px;
        box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
        z-index: 1000;
        padding: 20px;
        min-width: 400px;
        display: none;
        border: 1px solid #e0e0e0;
      }

      .card-header {
        font-weight: bold;
        color: #333;
        margin-bottom: 15px;
        font-size: 16px;
        display: flex;
        align-items: center;
        gap: 8px;
      }

      .coordinate-item {
        margin-bottom: 12px;
        display: flex;
        justify-content: space-between;
        align-items: center;
      }

      .coordinate-item:last-child {
        margin-bottom: 0;
      }

      .coordinate-label {
        font-weight: 500;
        color: #555;
        font-size: 14px;
        min-width: 140px;
      }

      .coordinate-value {
        font-family: 'Courier New', monospace;
        color: #666;
        font-size: 14px;
        text-align: right;
        flex: 1;
      }
    </style>
    <!-- OpenLayers JavaScript - ä½¿ç”¨æœ¬åœ°åº“æ–‡ä»¶ -->
    <script src="/libs/Openlayers/ol.min.js"></script>
  </head>
  <body>
    <div id="map"></div>

    <!-- é¼ æ ‡æç¤º -->
    <div class="mouse-tip">
      <div>ğŸ’¡ ç‚¹å‡»åœ°å›¾è·å–åæ ‡</div>
      <div style="font-size: 12px; margin-top: 5px; opacity: 0.8">æ”¯æŒå¤šç§åæ ‡æ ¼å¼æ˜¾ç¤º</div>
    </div>

    <!-- åº•éƒ¨åæ ‡å¡ç‰‡ -->
    <div class="coordinate-card" id="coordinateCard">
      <div class="card-header">ğŸ“ åœ°å›¾åæ ‡ä¿¡æ¯</div>
      <div class="coordinate-item">
        <span class="coordinate-label">ğŸŒ ç»çº¬åº¦åæ ‡</span>
        <span class="coordinate-value" id="lonLatCoord">-</span>
      </div>
      <div class="coordinate-item">
        <span class="coordinate-label">ğŸ—ºï¸ Webå¢¨å¡æ‰˜åæ ‡</span>
        <span class="coordinate-value" id="webMercatorCoord">-</span>
      </div>
      <div class="coordinate-item">
        <span class="coordinate-label">ğŸ“ åƒç´ åæ ‡</span>
        <span class="coordinate-value" id="pixelCoord">-</span>
      </div>
      <div class="coordinate-item">
        <span class="coordinate-label">ğŸ” å½“å‰ç¼©æ”¾çº§åˆ«</span>
        <span class="coordinate-value" id="zoomLevel">-</span>
      </div>
    </div>

    <script>
      // å¤©åœ°å›¾API Key
      const TIANDITU_KEY = '3764ab3da844e87462f2f827afa0f9f3'

      // æ­¦æ±‰åæ ‡ (ç»åº¦, çº¬åº¦)
      const WUHAN_COORDS = [114.3162, 30.581]

      let map = null

      // æ˜¾ç¤ºåæ ‡ä¿¡æ¯
      function showCoordinateInfo(coordinate, pixelCoord) {
        // è½¬æ¢ä¸ºç»çº¬åº¦åæ ‡
        const lonLatCoord = ol.proj.toLonLat(coordinate)
        const lon = lonLatCoord[0].toFixed(6)
        const lat = lonLatCoord[1].toFixed(6)

        // è·å–å½“å‰ç¼©æ”¾çº§åˆ«
        const zoom = map.getView().getZoom().toFixed(2)

        // æ›´æ–°å¡ç‰‡å†…å®¹
        document.getElementById('lonLatCoord').textContent = `${lon}Â°, ${lat}Â°`
        document.getElementById('webMercatorCoord').textContent =
          `${coordinate[0].toFixed(2)}, ${coordinate[1].toFixed(2)}`
        document.getElementById('pixelCoord').textContent = `${pixelCoord[0]}, ${pixelCoord[1]}`
        document.getElementById('zoomLevel').textContent = `ç¬¬ ${zoom} çº§`

        // æ˜¾ç¤ºå¡ç‰‡
        document.getElementById('coordinateCard').style.display = 'block'
      }

      // åˆå§‹åŒ–åœ°å›¾
      function initMap() {
        try {
          // æ£€æŸ¥ ol æ˜¯å¦åŠ è½½æˆåŠŸ
          if (typeof ol === 'undefined') {
            throw new Error('OpenLayers åº“åŠ è½½å¤±è´¥')
          }

          // åˆ›å»ºå¤©åœ°å›¾çŸ¢é‡å›¾å±‚
          const vectorLayer = new ol.layer.Tile({
            source: new ol.source.XYZ({
              url: `http://t{0-7}.tianditu.gov.cn/vec_w/wmts?SERVICE=WMTS&REQUEST=GetTile&VERSION=1.0.0&LAYER=vec&STYLE=default&TILEMATRIXSET=w&FORMAT=tiles&TILEMATRIX={z}&TILEROW={y}&TILECOL={x}&tk=${TIANDITU_KEY}`,
              wrapX: false,
            }),
          })

          // åˆ›å»ºå¤©åœ°å›¾çŸ¢é‡æ³¨è®°å›¾å±‚
          const vectorLabelLayer = new ol.layer.Tile({
            source: new ol.source.XYZ({
              url: `http://t{0-7}.tianditu.gov.cn/cva_w/wmts?SERVICE=WMTS&REQUEST=GetTile&VERSION=1.0.0&LAYER=cva&STYLE=default&TILEMATRIXSET=w&FORMAT=tiles&TILEMATRIX={z}&TILEROW={y}&TILECOL={x}&tk=${TIANDITU_KEY}`,
              wrapX: false,
            }),
          })

          // åˆå§‹åŒ–åœ°å›¾
          map = new ol.Map({
            target: 'map',
            layers: [vectorLayer, vectorLabelLayer],
            view: new ol.View({
              center: ol.proj.fromLonLat(WUHAN_COORDS), // å°†ç»çº¬åº¦è½¬æ¢ä¸ºæŠ•å½±åæ ‡
              zoom: 12,
              maxZoom: 18,
              minZoom: 3,
            }),
            controls: [new ol.control.Zoom(), new ol.control.Attribution()],
          })

          // æ·»åŠ åœ°å›¾ç‚¹å‡»äº‹ä»¶
          map.on('click', function (event) {
            const coordinate = event.coordinate
            const pixelCoord = event.pixel
            showCoordinateInfo(coordinate, pixelCoord)
          })

          console.log('OpenLayers å¤©åœ°å›¾çŸ¢é‡åœ°å›¾åˆå§‹åŒ–å®Œæˆ')
          console.log('ğŸ’¡ ç‚¹å‡»åœ°å›¾ä»»æ„ä½ç½®è·å–åæ ‡ä¿¡æ¯')
        } catch (error) {
          console.error('åœ°å›¾åˆå§‹åŒ–å¤±è´¥:', error)
        }
      }

      // é¡µé¢åŠ è½½å®Œæˆååˆå§‹åŒ–åœ°å›¾
      document.addEventListener('DOMContentLoaded', initMap)
    </script>
  </body>
</html>
